# 積み上げ表示

## 概要
詳細は、提供されたPDFを参照すること。

 - 以下のようなレベルで積み上げを表示する。

大区分 - 中区分 - 小区分

部署  - アサイン済み - 担当者

　　　未アサイン - 設備

　　　未確定 - 設備

- 単位は人日（稼働時間 / 8) で計算する。
- 表示時は小数第２位を四捨五入とする
- 未確定をチェックをしたときに部署の行に未確定の人数が追加される
- 部署だけ決まっていて未アサインという理解
- 未確定となった設備は全ての担当者アサインを削除する。


## ロジック整理

- 基本は initPileUps 初期化している、デフォルト値がある場合はここで上書き。
- チケットをループしてpileUpsを更新している。
- 部署の集約が意味なくなっているので削除する
- 今のロジックに案件の箱を作ればよさそう
- 作り直すか結構迷う内容ではある。
- きたねえしやっぱり作り直そう


メモどの箱に入れるかってだけか

担当者の工数計算
1. 全体の開始日・終了日から日付分の箱を作成する
2. チケットの開始日・終了日から箱のIndexを決定する validIndexes
3. validIndexes から祝日があれば削除する
4. １日当たりの工数を計算（全工数h / 人数 / 期間）
4. 予定工数を1日当たりの工数を計算引き算しながら箱に割り当てる
   5. 優先順位は末端の予定工数が少ないジュン、チケットにアサインされた順

部署の工数計算
1. 担当者の工数計算の結果から稼働予定工数をすべて足す
2. 以上

とりあえずフロントから作り直してどうなるかった感じでやるか。
いずれにせよ汚いから、内部データを作る→表示用に成形するで作り直す


## 本当のロジックメモ

1. チケット（１行筒処理をする）
2. アサイン済みに関してはそれでOK
3. 部署の行は計算結果から導かれる値なので先に行計算を全て行う必要あり。
4. なんかいろいろ考慮する必要があるな～
5. 今思うのユーザー削除時におかしくなる？いやユーザー削除したら消えるかラ問題ではないけどエラーハンドリングはするべきだな
6. でもまあさすがにパフォーマンス考えると集計しなおしは厳しいか


## 作業メモ
とりあえず部署のエラーツールチップ以外は実装完了。
というか必要なの？って感じなのでしかとしてそのまま提供してみる。
本チャンデータコピーしてきて動作確認をする。

